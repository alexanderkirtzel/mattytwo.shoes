/*!
 * Form tracking for Snowplow v3.1.6 (http://bit.ly/sp-js)
 * Copyright 2021 Snowplow Analytics Ltd, 2010 Anthon Pang
 * Licensed under BSD-3-Clause
 */

"use strict";!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).snowplowFormTracking={})}(this,(function(e){function n(e){for(var n,r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return null!==(n=null==e?void 0:e.map((function(e){if("function"!=typeof e)return e;try{return e.apply(void 0,r)}catch(e){}})).filter(Boolean))&&void 0!==n?n:[]}function r(e){var n=e.event;e=n.schema;var r=n.data;return n=function(){var e,n={},r=[],t=[],o=function(e,r){null!=r&&""!==r&&(n[e]=r)};return{add:o,addDict:function(e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o(n,e[n])},addJson:function(e,n,o){var a;if(a=o)e:{if(null!=o&&(o.constructor==={}.constructor||o.constructor===[].constructor))for(var l in o)if(Object.prototype.hasOwnProperty.call(o,l)){a=!0;break e}a=!1}a&&(e={keyIfEncoded:e,keyIfNotEncoded:n,json:o},t.push(e),r.push(e))},getPayload:function(){return n},getJson:function(){return r},withJsonProcessor:function(n){e=n},build:function(){return null==e||e(this,t),n}}}(),e={schema:"iglu:com.snowplowanalytics.snowplow/unstruct_event/jsonschema/1-0-0",data:{schema:e,data:r}},n.add("e","ue"),n.addJson("ue_px","ue_pr",e),n}function t(e,n){void 0===n&&(n={});var r,t={};for(r in e)(n[r]||null!==e[r]&&void 0!==e[r])&&(t[r]=e[r]);return t}function o(e,n,r,t){return e.addEventListener?(e.addEventListener(n,r,t),!0):e.attachEvent?e.attachEvent("on"+n,r):void(e["on"+n]=r)}function a(e){if(null==e||"object"!=typeof e||Array.isArray(e))return function(){return!0};var n=Object.prototype.hasOwnProperty.call(e,"allowlist"),r=c(e);return i(e,(function(e){e:{var t=0;for(e=e.className.match(/\S+/g)||[];t<e.length;t++)if(r[e[t]]){t=!0;break e}t=!1}return t===n}))}function l(e){if(null==e||"object"!=typeof e||Array.isArray(e))return function(){return!0};var n=e.hasOwnProperty("allowlist"),r=c(e);return i(e,(function(e){return e.name in r===n}))}function i(e,n){return e.hasOwnProperty("filter")&&e.filter?e.filter:n}function c(e){var n={};if(e=e.allowlist||e.denylist){Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++)n[e[r]]=!0}return n}function u(e,i){var c=i.context,u=e.id+"form",m=function(e){return e?{formFilter:a(e.forms),fieldFilter:l(e.fields),fieldTransform:f(e.fields)}:{formFilter:function(){return!0},fieldFilter:function(){return!0},fieldTransform:v}}(i.options);Array.prototype.slice.call(document.getElementsByTagName("form")).forEach((function(a){m.formFilter(a)&&!a[u]&&(Array.prototype.slice.call(y).forEach((function(n){Array.prototype.slice.call(a.getElementsByTagName(n)).forEach((function(n){m.fieldFilter(n)&&!n[u]&&"password"!==n.type.toLowerCase()&&(o(n,"focus",d(e,m,"focus_form",c),!1),o(n,"change",d(e,m,"change_form",c),!1),n[u]=!0)}))})),o(a,"submit",function(e,o,a,l){return function(i){var c;i=i.target;var u=function(e,n){var r=[];return Array.prototype.slice.call(y).forEach((function(t){t=Array.prototype.slice.call(n.getElementsByTagName(t)).filter((function(n){return n.hasOwnProperty(e)})),Array.prototype.slice.call(t).forEach((function(e){if("submit"!==e.type){var n={name:s(e),value:e.value,nodeName:e.nodeName};e.type&&"INPUT"===e.nodeName.toUpperCase()&&(n.type=e.type),"checkbox"!==e.type&&"radio"!==e.type||e.checked||(n.value=null),r.push(n)}}))})),r}(a,i);u.forEach((function(e){var n;e.value=null!==(n=o.fieldTransform(e.value,e))&&void 0!==n?n:e.value})),e.core.track(function(e){return r({event:{schema:"iglu:com.snowplowanalytics.snowplow/submit_form/jsonschema/1-0-0",data:t({formId:e.formId,formClasses:e.formClasses,elements:e.elements})}})}({formId:null!==(c=s(i))&&void 0!==c?c:"",formClasses:i.className.match(/\S+/g)||[],elements:u}),n(l,i,u))}}(e,m,u,c)),a[u]=!0)}))}function f(e){return e&&Object.prototype.hasOwnProperty.call(e,"transform")?e.transform:v}function s(e){for(var n=0,r=["name","id","type","nodeName"];n<r.length;n++){var t=r[n];if(0!=e[t]&&"string"==typeof e[t])return e[t]}return null}function d(e,o,a,l){return function(i){var c;if(i=i.target){var u=i.nodeName&&"INPUT"===i.nodeName.toUpperCase()?i.type:null,f="checkbox"!==i.type||i.checked?o.fieldTransform(i.value,i):null;if("change_form"===a||"checkbox"!==u&&"radio"!==u){var d,m=e.core,p=m.track;for(d=i;d&&d.nodeName&&"HTML"!==d.nodeName.toUpperCase()&&"FORM"!==d.nodeName.toUpperCase();)d=d.parentNode;d=null!=(d=d&&d.nodeName&&"FORM"===d.nodeName.toUpperCase()?s(d):null)?d:"";var y=null!==(c=s(i))&&void 0!==c?c:"";c="",d={formId:d,elementId:y,nodeName:i.nodeName,elementClasses:i.className.match(/\S+/g)||[],value:null!=f?f:null},"change_form"===a?(c="iglu:com.snowplowanalytics.snowplow/change_form/jsonschema/1-0-0",d.type=u):"focus_form"===a&&(c="iglu:com.snowplowanalytics.snowplow/focus_form/jsonschema/1-0-0",d.elementType=u),c=r({event:{schema:c,data:t(d,{value:!0})}}),p.call(m,c,n(l,i,u,f))}}}}var m,p;(p=m||(m={}))[p.none=0]="none",p[p.error=1]="error",p[p.warn=2]="warn",p[p.debug=3]="debug",p[p.info=4]="info",function(e){void 0===e&&(e=m.warn)}();var y=["textarea","input","select"],v=function(e){return e},h={};e.FormTrackingPlugin=function(){return{activateBrowserPlugin:function(e){h[e.id]=e}}},e.enableFormTracking=function(e,n){void 0===e&&(e={}),void 0===n&&(n=Object.keys(h)),n.forEach((function(n){h[n]&&(h[n].sharedState.hasLoaded?u(h[n],e):h[n].sharedState.registeredOnLoadHandlers.push((function(){u(h[n],e)})))}))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
