{"version":3,"file":"index.module.js","sources":["../src/helpers.ts","../src/index.ts"],"sourcesContent":["/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport {\n  getCssClasses,\n  addEventListener,\n  BrowserTracker,\n  FilterCriterion,\n  getFilterByClass,\n  getFilterByName,\n} from '@snowplow/browser-tracker-core';\nimport {\n  resolveDynamicContext,\n  DynamicContext,\n  buildFormFocusOrChange,\n  buildFormSubmission,\n} from '@snowplow/tracker-core';\n\n/** The form tracking configuration */\nexport interface FormTrackingConfiguration {\n  /** The options which can be configured for the form tracking events */\n  options?: FormTrackingOptions;\n  /** The dyanmic context which will be evaluated for each form event */\n  context?: DynamicContext | null;\n}\n\nexport interface FormTrackingOptions {\n  forms?: FilterCriterion<HTMLElement>;\n  fields?: FilterCriterion<TrackedHTMLElement> & { transform: transformFn };\n}\n\nexport interface TrackedHTMLElementTagNameMap {\n  textarea: HTMLTextAreaElement;\n  input: HTMLInputElement;\n  select: HTMLSelectElement;\n}\n\nexport type TrackedHTMLElement = TrackedHTMLElementTagNameMap[keyof TrackedHTMLElementTagNameMap];\n\nexport interface ElementData extends Record<string, string | null | undefined> {\n  name: string;\n  value: string | null;\n  nodeName: string;\n  type?: string;\n}\n\nexport type transformFn = (x: string | null, elt: ElementData | TrackedHTMLElement) => string | null;\n\nexport const innerElementTags: Array<keyof TrackedHTMLElementTagNameMap> = ['textarea', 'input', 'select'];\n\nconst defaultTransformFn: transformFn = (x) => x;\n\ninterface FormConfiguration {\n  formFilter: (_: HTMLFormElement) => boolean;\n  fieldFilter: (_: TrackedHTMLElement) => boolean;\n  fieldTransform: transformFn;\n}\n\n/*\n * Add submission event listeners to all form elements\n * Add value change event listeners to all mutable inner form elements\n */\nexport function addFormListeners(tracker: BrowserTracker, configuration: FormTrackingConfiguration) {\n  const { options, context } = configuration,\n    trackingMarker = tracker.id + 'form',\n    config = getConfigurationForOptions(options);\n\n  Array.prototype.slice.call(document.getElementsByTagName('form')).forEach(function (form) {\n    if (config.formFilter(form) && !form[trackingMarker]) {\n      Array.prototype.slice.call(innerElementTags).forEach(function (tagname) {\n        Array.prototype.slice.call(form.getElementsByTagName(tagname)).forEach(function (innerElement) {\n          if (\n            config.fieldFilter(innerElement) &&\n            !(innerElement as any)[trackingMarker] &&\n            innerElement.type.toLowerCase() !== 'password'\n          ) {\n            addEventListener(\n              innerElement,\n              'focus',\n              getFormChangeListener(tracker, config, 'focus_form', context),\n              false\n            );\n            addEventListener(\n              innerElement,\n              'change',\n              getFormChangeListener(tracker, config, 'change_form', context),\n              false\n            );\n            (innerElement as any)[trackingMarker] = true;\n          }\n        });\n      });\n\n      addEventListener(form, 'submit', getFormSubmissionListener(tracker, config, trackingMarker, context));\n      form[trackingMarker] = true;\n    }\n  });\n}\n\n/*\n * Configures form tracking: which forms and fields will be tracked, and the context to attach\n */\nfunction getConfigurationForOptions(options?: FormTrackingOptions) {\n  if (options) {\n    return {\n      formFilter: getFilterByClass(options.forms),\n      fieldFilter: getFilterByName<TrackedHTMLElement>(options.fields),\n      fieldTransform: getTransform(options.fields),\n    };\n  } else {\n    return {\n      formFilter: () => true,\n      fieldFilter: () => true,\n      fieldTransform: defaultTransformFn,\n    };\n  }\n}\n\n/**\n * Convert a criterion object to a transform function\n *\n * @param object - criterion {transform: function (elt) {return the result of transform function applied to element}\n */\nfunction getTransform(criterion?: { transform: transformFn }): transformFn {\n  if (criterion && Object.prototype.hasOwnProperty.call(criterion, 'transform')) {\n    return criterion.transform;\n  }\n\n  return defaultTransformFn;\n}\n\n/*\n * Get an identifier for a form, input, textarea, or select element\n */\nfunction getElementIdentifier(elt: Record<string, any>) {\n  const properties: Array<'name' | 'id' | 'type' | 'nodeName'> = ['name', 'id', 'type', 'nodeName'];\n  for (const propName of properties) {\n    if (elt[propName] != false && typeof elt[propName] === 'string') {\n      return elt[propName];\n    }\n  }\n\n  return null;\n}\n\n/*\n * Identifies the parent form in which an element is contained\n */\nfunction getParentFormIdentifier(elt: Node | null) {\n  while (elt && elt.nodeName && elt.nodeName.toUpperCase() !== 'HTML' && elt.nodeName.toUpperCase() !== 'FORM') {\n    elt = elt.parentNode;\n  }\n  if (elt && elt.nodeName && elt.nodeName.toUpperCase() === 'FORM') {\n    return getElementIdentifier(elt);\n  }\n\n  return null;\n}\n\n/*\n * Returns a list of the input, textarea, and select elements inside a form along with their values\n */\nfunction getInnerFormElements(trackingMarker: string, elt: HTMLFormElement) {\n  var innerElements: Array<ElementData> = [];\n  Array.prototype.slice.call(innerElementTags).forEach((tagname: 'textarea' | 'input' | 'select') => {\n    let trackedChildren = Array.prototype.slice.call(elt.getElementsByTagName(tagname)).filter(function (child) {\n      return child.hasOwnProperty(trackingMarker);\n    });\n\n    Array.prototype.slice.call(trackedChildren).forEach(function (child) {\n      if (child.type === 'submit') {\n        return;\n      }\n      var elementJson: ElementData = {\n        name: getElementIdentifier(child),\n        value: child.value,\n        nodeName: child.nodeName,\n      };\n      if (child.type && child.nodeName.toUpperCase() === 'INPUT') {\n        elementJson.type = child.type;\n      }\n\n      if ((child.type === 'checkbox' || child.type === 'radio') && !(child as HTMLInputElement).checked) {\n        elementJson.value = null;\n      }\n      innerElements.push(elementJson);\n    });\n  });\n\n  return innerElements;\n}\n\n/*\n * Return function to handle form field change event\n */\nfunction getFormChangeListener(\n  tracker: BrowserTracker,\n  config: FormConfiguration,\n  event_type: 'change_form' | 'focus_form',\n  context?: DynamicContext | null\n) {\n  return function (e: Event) {\n    var elt = e.target as TrackedHTMLElement;\n    if (elt) {\n      var type = elt.nodeName && elt.nodeName.toUpperCase() === 'INPUT' ? elt.type : null;\n      var value =\n        elt.type === 'checkbox' && !(elt as HTMLInputElement).checked ? null : config.fieldTransform(elt.value, elt);\n      if (event_type === 'change_form' || (type !== 'checkbox' && type !== 'radio')) {\n        tracker.core.track(\n          buildFormFocusOrChange({\n            schema: event_type,\n            formId: getParentFormIdentifier(elt) ?? '',\n            elementId: getElementIdentifier(elt) ?? '',\n            nodeName: elt.nodeName,\n            type,\n            elementClasses: getCssClasses(elt),\n            value: value ?? null,\n          }),\n          resolveDynamicContext(context, elt, type, value)\n        );\n      }\n    }\n  };\n}\n\n/*\n * Return function to handle form submission event\n */\nfunction getFormSubmissionListener(\n  tracker: BrowserTracker,\n  config: FormConfiguration,\n  trackingMarker: string,\n  context?: DynamicContext | null\n) {\n  return function (e: Event) {\n    var elt = e.target as HTMLFormElement;\n    var innerElements = getInnerFormElements(trackingMarker, elt);\n    innerElements.forEach(function (innerElement) {\n      innerElement.value = config.fieldTransform(innerElement.value, innerElement) ?? innerElement.value;\n    });\n    tracker.core.track(\n      buildFormSubmission({\n        formId: getElementIdentifier(elt) ?? '',\n        formClasses: getCssClasses(elt),\n        elements: innerElements,\n      }),\n      resolveDynamicContext(context, elt, innerElements)\n    );\n  };\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { BrowserPlugin, BrowserTracker } from '@snowplow/browser-tracker-core';\nimport { addFormListeners, FormTrackingConfiguration } from './helpers';\n\nexport { FormTrackingConfiguration } from './helpers';\n\nconst _trackers: Record<string, BrowserTracker> = {};\n\n/**\n * A plugin which enabled automatic form tracking\n */\nexport function FormTrackingPlugin(): BrowserPlugin {\n  return {\n    activateBrowserPlugin: (tracker: BrowserTracker) => {\n      _trackers[tracker.id] = tracker;\n    },\n  };\n}\n\n/**\n * Enables automatic form tracking\n * An event will be fired when a form field is changed or a form submitted.\n * This can be called multiple times: only forms not already tracked will be tracked.\n *\n * @param configuration - The form tracking configuration\n * @param trackers - The tracker identifiers which the events will be sent to\n */\nexport function enableFormTracking(\n  configuration: FormTrackingConfiguration = {},\n  trackers: Array<string> = Object.keys(_trackers)\n) {\n  trackers.forEach((t) => {\n    if (_trackers[t]) {\n      if (_trackers[t].sharedState.hasLoaded) {\n        addFormListeners(_trackers[t], configuration);\n      } else {\n        _trackers[t].sharedState.registeredOnLoadHandlers.push(function () {\n          addFormListeners(_trackers[t], configuration);\n        });\n      }\n    }\n  });\n}\n"],"names":[],"mappings":"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"}