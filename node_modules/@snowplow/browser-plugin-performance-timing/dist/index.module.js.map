{"version":3,"file":"index.module.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { BrowserPlugin } from '@snowplow/browser-tracker-core';\nimport { PerformanceTiming } from './contexts';\n\ndeclare global {\n  interface Window {\n    mozPerformance: any;\n    msPerformance: any;\n    webkitPerformance: any;\n  }\n}\n\n/**\n * Adds Performance Timing context to events\n *\n * @remarks\n * May not be fully populated when inital Page View fires\n * Often a good idea to take the latest performance timing context\n * for a given page view id when analysing in the warehouse\n */\nexport function PerformanceTimingPlugin(): BrowserPlugin {\n  /**\n   * Creates a context from the window.performance.timing object\n   *\n   * @returns object PerformanceTiming context\n   */\n  function getPerformanceTimingContext() {\n    var windowAlias = window,\n      performanceAlias =\n        windowAlias.performance ||\n        windowAlias.mozPerformance ||\n        windowAlias.msPerformance ||\n        windowAlias.webkitPerformance,\n      performanceTimingAlias = performanceAlias.timing;\n\n    if (performanceAlias) {\n      const performanceTiming: PerformanceTiming = {\n        navigationStart: performanceTimingAlias.navigationStart,\n        redirectStart: performanceTimingAlias.redirectStart,\n        redirectEnd: performanceTimingAlias.redirectEnd,\n        fetchStart: performanceTimingAlias.fetchStart,\n        domainLookupStart: performanceTimingAlias.domainLookupStart,\n        domainLookupEnd: performanceTimingAlias.domainLookupEnd,\n        connectStart: performanceTimingAlias.connectStart,\n        secureConnectionStart: performanceTimingAlias.secureConnectionStart,\n        connectEnd: performanceTimingAlias.connectEnd,\n        requestStart: performanceTimingAlias.requestStart,\n        responseStart: performanceTimingAlias.responseStart,\n        responseEnd: performanceTimingAlias.responseEnd,\n        unloadEventStart: performanceTimingAlias.unloadEventStart,\n        unloadEventEnd: performanceTimingAlias.unloadEventEnd,\n        domLoading: performanceTimingAlias.domLoading,\n        domInteractive: performanceTimingAlias.domInteractive,\n        domContentLoadedEventStart: performanceTimingAlias.domContentLoadedEventStart,\n        domContentLoadedEventEnd: performanceTimingAlias.domContentLoadedEventEnd,\n        domComplete: performanceTimingAlias.domComplete,\n        loadEventStart: performanceTimingAlias.loadEventStart,\n        loadEventEnd: performanceTimingAlias.loadEventEnd,\n        msFirstPaint: (<any>performanceTimingAlias).msFirstPaint,\n        chromeFirstPaint: (<any>performanceTimingAlias).chromeFirstPaint,\n        requestEnd: (<any>performanceTimingAlias).requestEnd,\n        proxyStart: (<any>performanceTimingAlias).proxyStart,\n        proxyEnd: (<any>performanceTimingAlias).proxyEnd,\n      };\n\n      return [\n        {\n          schema: 'iglu:org.w3/PerformanceTiming/jsonschema/1-0-0',\n          data: performanceTiming,\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  return {\n    contexts: () => getPerformanceTimingContext(),\n  };\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyCA;;;;;;;;SAQgB,uBAAuB;;;;;;IAMrC,SAAS,2BAA2B;QAClC,IAAI,WAAW,GAAG,MAAM,EACtB,gBAAgB,GACd,WAAW,CAAC,WAAW;YACvB,WAAW,CAAC,cAAc;YAC1B,WAAW,CAAC,aAAa;YACzB,WAAW,CAAC,iBAAiB,EAC/B,sBAAsB,GAAG,gBAAgB,CAAC,MAAM,CAAC;QAEnD,IAAI,gBAAgB,EAAE;YACpB,IAAM,iBAAiB,GAAsB;gBAC3C,eAAe,EAAE,sBAAsB,CAAC,eAAe;gBACvD,aAAa,EAAE,sBAAsB,CAAC,aAAa;gBACnD,WAAW,EAAE,sBAAsB,CAAC,WAAW;gBAC/C,UAAU,EAAE,sBAAsB,CAAC,UAAU;gBAC7C,iBAAiB,EAAE,sBAAsB,CAAC,iBAAiB;gBAC3D,eAAe,EAAE,sBAAsB,CAAC,eAAe;gBACvD,YAAY,EAAE,sBAAsB,CAAC,YAAY;gBACjD,qBAAqB,EAAE,sBAAsB,CAAC,qBAAqB;gBACnE,UAAU,EAAE,sBAAsB,CAAC,UAAU;gBAC7C,YAAY,EAAE,sBAAsB,CAAC,YAAY;gBACjD,aAAa,EAAE,sBAAsB,CAAC,aAAa;gBACnD,WAAW,EAAE,sBAAsB,CAAC,WAAW;gBAC/C,gBAAgB,EAAE,sBAAsB,CAAC,gBAAgB;gBACzD,cAAc,EAAE,sBAAsB,CAAC,cAAc;gBACrD,UAAU,EAAE,sBAAsB,CAAC,UAAU;gBAC7C,cAAc,EAAE,sBAAsB,CAAC,cAAc;gBACrD,0BAA0B,EAAE,sBAAsB,CAAC,0BAA0B;gBAC7E,wBAAwB,EAAE,sBAAsB,CAAC,wBAAwB;gBACzE,WAAW,EAAE,sBAAsB,CAAC,WAAW;gBAC/C,cAAc,EAAE,sBAAsB,CAAC,cAAc;gBACrD,YAAY,EAAE,sBAAsB,CAAC,YAAY;gBACjD,YAAY,EAAQ,sBAAuB,CAAC,YAAY;gBACxD,gBAAgB,EAAQ,sBAAuB,CAAC,gBAAgB;gBAChE,UAAU,EAAQ,sBAAuB,CAAC,UAAU;gBACpD,UAAU,EAAQ,sBAAuB,CAAC,UAAU;gBACpD,QAAQ,EAAQ,sBAAuB,CAAC,QAAQ;aACjD,CAAC;YAEF,OAAO;gBACL;oBACE,MAAM,EAAE,gDAAgD;oBACxD,IAAI,EAAE,iBAAiB;iBACxB;aACF,CAAC;SACH;QAED,OAAO,EAAE,CAAC;KACX;IAED,OAAO;QACL,QAAQ,EAAE,cAAM,OAAA,2BAA2B,EAAE,GAAA;KAC9C,CAAC;AACJ;;"}