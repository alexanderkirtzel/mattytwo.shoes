{"version":3,"file":"index.umd.min.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { BrowserPlugin } from '@snowplow/browser-tracker-core';\nimport { PerformanceTiming } from './contexts';\n\ndeclare global {\n  interface Window {\n    mozPerformance: any;\n    msPerformance: any;\n    webkitPerformance: any;\n  }\n}\n\n/**\n * Adds Performance Timing context to events\n *\n * @remarks\n * May not be fully populated when inital Page View fires\n * Often a good idea to take the latest performance timing context\n * for a given page view id when analysing in the warehouse\n */\nexport function PerformanceTimingPlugin(): BrowserPlugin {\n  /**\n   * Creates a context from the window.performance.timing object\n   *\n   * @returns object PerformanceTiming context\n   */\n  function getPerformanceTimingContext() {\n    var windowAlias = window,\n      performanceAlias =\n        windowAlias.performance ||\n        windowAlias.mozPerformance ||\n        windowAlias.msPerformance ||\n        windowAlias.webkitPerformance,\n      performanceTimingAlias = performanceAlias.timing;\n\n    if (performanceAlias) {\n      const performanceTiming: PerformanceTiming = {\n        navigationStart: performanceTimingAlias.navigationStart,\n        redirectStart: performanceTimingAlias.redirectStart,\n        redirectEnd: performanceTimingAlias.redirectEnd,\n        fetchStart: performanceTimingAlias.fetchStart,\n        domainLookupStart: performanceTimingAlias.domainLookupStart,\n        domainLookupEnd: performanceTimingAlias.domainLookupEnd,\n        connectStart: performanceTimingAlias.connectStart,\n        secureConnectionStart: performanceTimingAlias.secureConnectionStart,\n        connectEnd: performanceTimingAlias.connectEnd,\n        requestStart: performanceTimingAlias.requestStart,\n        responseStart: performanceTimingAlias.responseStart,\n        responseEnd: performanceTimingAlias.responseEnd,\n        unloadEventStart: performanceTimingAlias.unloadEventStart,\n        unloadEventEnd: performanceTimingAlias.unloadEventEnd,\n        domLoading: performanceTimingAlias.domLoading,\n        domInteractive: performanceTimingAlias.domInteractive,\n        domContentLoadedEventStart: performanceTimingAlias.domContentLoadedEventStart,\n        domContentLoadedEventEnd: performanceTimingAlias.domContentLoadedEventEnd,\n        domComplete: performanceTimingAlias.domComplete,\n        loadEventStart: performanceTimingAlias.loadEventStart,\n        loadEventEnd: performanceTimingAlias.loadEventEnd,\n        msFirstPaint: (<any>performanceTimingAlias).msFirstPaint,\n        chromeFirstPaint: (<any>performanceTimingAlias).chromeFirstPaint,\n        requestEnd: (<any>performanceTimingAlias).requestEnd,\n        proxyStart: (<any>performanceTimingAlias).proxyStart,\n        proxyEnd: (<any>performanceTimingAlias).proxyEnd,\n      };\n\n      return [\n        {\n          schema: 'iglu:org.w3/PerformanceTiming/jsonschema/1-0-0',\n          data: performanceTiming,\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  return {\n    contexts: () => getPerformanceTimingContext(),\n  };\n}\n"],"names":["contexts","windowAlias","window","performanceTimingAlias","performance","mozPerformance","msPerformance","webkitPerformance","timing","performanceAlias","schema","data","performanceTiming","navigationStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","secureConnectionStart","connectEnd","requestStart","responseStart","responseEnd","unloadEventStart","unloadEventEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd","msFirstPaint","chromeFirstPaint","requestEnd","proxyStart","proxyEnd"],"mappings":";;;;;;sSAyGE,MAAO,CACLA,SAAUA,WAlDNC,IAAAA,EAAcC,OAMhBC,KAJEF,EAAYG,aACZH,EAAYI,gBACZJ,EAAYK,eACZL,EAAYM,mBAC4BC,gBAExCC,EA8BK,CACL,CACEC,OAAQ,iDACRC,KAhCyCC,CAC3CC,gBAAiBV,EAAuBU,gBACxCC,cAAeX,EAAuBW,cACtCC,YAAaZ,EAAuBY,YACpCC,WAAYb,EAAuBa,WACnCC,kBAAmBd,EAAuBc,kBAC1CC,gBAAiBf,EAAuBe,gBACxCC,aAAchB,EAAuBgB,aACrCC,sBAAuBjB,EAAuBiB,sBAC9CC,WAAYlB,EAAuBkB,WACnCC,aAAcnB,EAAuBmB,aACrCC,cAAepB,EAAuBoB,cACtCC,YAAarB,EAAuBqB,YACpCC,iBAAkBtB,EAAuBsB,iBACzCC,eAAgBvB,EAAuBuB,eACvCC,WAAYxB,EAAuBwB,WACnCC,eAAgBzB,EAAuByB,eACvCC,2BAA4B1B,EAAuB0B,2BACnDC,yBAA0B3B,EAAuB2B,yBACjDC,YAAa5B,EAAuB4B,YACpCC,eAAgB7B,EAAuB6B,eACvCC,aAAc9B,EAAuB8B,aACrCC,aAAoB/B,EAAwB+B,aAC5CC,iBAAwBhC,EAAwBgC,iBAChDC,WAAkBjC,EAAwBiC,WAC1CC,WAAkBlC,EAAwBkC,WAC1CC,SAAgBnC,EAAwBmC,YAWrC"}