{"version":3,"file":"index.umd.min.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { BrowserPlugin } from '@snowplow/browser-tracker-core';\nimport { HttpClientHints } from './contexts';\n\ninterface NavigatorUABrandVersion {\n  brand: string; // \"Google Chrome\"\n  version: string; // \"84\"\n}\n\ninterface UADataValues {\n  platform: string; // \"PhoneOS\"\n  platformVersion: string; // \"10A\"\n  architecture: string; // \"arm\"\n  model: string; // \"X644GTM\"\n  uaFullVersion: string; // \"73.32.AGX.5\"\n}\n\ndeclare global {\n  interface Navigator {\n    userAgentData: {\n      mobile: boolean;\n      brands: Array<NavigatorUABrandVersion>;\n      getHighEntropyValues: (hints: Array<string>) => Promise<UADataValues>;\n    };\n  }\n}\n\nlet uaClientHints: HttpClientHints;\n\n/**\n * Attaches Client Hint information where available\n * @param includeHighEntropy - Should high entropy values be included\n */\nexport function ClientHintsPlugin(includeHighEntropy?: boolean): BrowserPlugin {\n  const populateClientHints = () => {\n    const navigatorAlias = navigator;\n\n    if (navigatorAlias.userAgentData) {\n      uaClientHints = {\n        isMobile: navigatorAlias.userAgentData.mobile,\n        brands: navigatorAlias.userAgentData.brands,\n      };\n      if (includeHighEntropy && navigatorAlias.userAgentData.getHighEntropyValues) {\n        navigatorAlias.userAgentData\n          .getHighEntropyValues(['platform', 'platformVersion', 'architecture', 'model', 'uaFullVersion'])\n          .then((res) => {\n            uaClientHints.architecture = res.architecture;\n            uaClientHints.model = res.model;\n            uaClientHints.platform = res.platform;\n            uaClientHints.uaFullVersion = res.uaFullVersion;\n            uaClientHints.platformVersion = res.platformVersion;\n          });\n      }\n    }\n  };\n\n  return {\n    activateBrowserPlugin: () => {\n      if (!uaClientHints) {\n        populateClientHints();\n      }\n    },\n    contexts: () => {\n      if (uaClientHints) {\n        return [\n          {\n            schema: 'iglu:org.ietf/http_client_hints/jsonschema/1-0-0',\n            data: uaClientHints,\n          },\n        ];\n      }\n      return [];\n    },\n  };\n}\n"],"names":["uaClientHints","includeHighEntropy","activateBrowserPlugin","populateClientHints","navigatorAlias","navigator","userAgentData","isMobile","mobile","brands","getHighEntropyValues","then","res","architecture","model","platform","uaFullVersion","platformVersion","contexts","schema","data"],"mappings":";;;;;;2PAwDA,IAAIA,+BAM8BC,SAuBzB,CACLC,sBAAuBA,WAvBGC,IACpBC,EAuBCJ,IAvBDI,EAAiBC,WAEJC,gBACjBN,EAAgB,CACdO,SAAUH,EAAeE,cAAcE,OACvCC,OAAQL,EAAeE,cAAcG,QAEnCR,GAAsBG,EAAeE,cAAcI,sBACrDN,EAAeE,cACZI,qBAAqB,CAAC,WAAY,kBAAmB,eAAgB,QAAS,kBAC9EC,MAAK,SAACC,GACLZ,EAAca,aAAeD,EAAIC,eACnBC,MAAQF,EAAIE,QACZC,SAAWH,EAAIG,WACfC,cAAgBJ,EAAII,gBACpBC,gBAAkBL,EAAIK,qBAY5CC,SAAUA,WACR,SACS,CACL,CACEC,OAAQ,mDACRC,KAAMpB,IAIL"}