{"version":3,"file":"index.umd.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { BrowserPlugin } from '@snowplow/browser-tracker-core';\nimport { HttpClientHints } from './contexts';\n\ninterface NavigatorUABrandVersion {\n  brand: string; // \"Google Chrome\"\n  version: string; // \"84\"\n}\n\ninterface UADataValues {\n  platform: string; // \"PhoneOS\"\n  platformVersion: string; // \"10A\"\n  architecture: string; // \"arm\"\n  model: string; // \"X644GTM\"\n  uaFullVersion: string; // \"73.32.AGX.5\"\n}\n\ndeclare global {\n  interface Navigator {\n    userAgentData: {\n      mobile: boolean;\n      brands: Array<NavigatorUABrandVersion>;\n      getHighEntropyValues: (hints: Array<string>) => Promise<UADataValues>;\n    };\n  }\n}\n\nlet uaClientHints: HttpClientHints;\n\n/**\n * Attaches Client Hint information where available\n * @param includeHighEntropy - Should high entropy values be included\n */\nexport function ClientHintsPlugin(includeHighEntropy?: boolean): BrowserPlugin {\n  const populateClientHints = () => {\n    const navigatorAlias = navigator;\n\n    if (navigatorAlias.userAgentData) {\n      uaClientHints = {\n        isMobile: navigatorAlias.userAgentData.mobile,\n        brands: navigatorAlias.userAgentData.brands,\n      };\n      if (includeHighEntropy && navigatorAlias.userAgentData.getHighEntropyValues) {\n        navigatorAlias.userAgentData\n          .getHighEntropyValues(['platform', 'platformVersion', 'architecture', 'model', 'uaFullVersion'])\n          .then((res) => {\n            uaClientHints.architecture = res.architecture;\n            uaClientHints.model = res.model;\n            uaClientHints.platform = res.platform;\n            uaClientHints.uaFullVersion = res.uaFullVersion;\n            uaClientHints.platformVersion = res.platformVersion;\n          });\n      }\n    }\n  };\n\n  return {\n    activateBrowserPlugin: () => {\n      if (!uaClientHints) {\n        populateClientHints();\n      }\n    },\n    contexts: () => {\n      if (uaClientHints) {\n        return [\n          {\n            schema: 'iglu:org.ietf/http_client_hints/jsonschema/1-0-0',\n            data: uaClientHints,\n          },\n        ];\n      }\n      return [];\n    },\n  };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;EAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAwDA,IAAI,aAA8B,CAAC;EAEnC;;;;WAIgB,iBAAiB,CAAC,kBAA4B;MAC5D,IAAM,mBAAmB,GAAG;UAC1B,IAAM,cAAc,GAAG,SAAS,CAAC;UAEjC,IAAI,cAAc,CAAC,aAAa,EAAE;cAChC,aAAa,GAAG;kBACd,QAAQ,EAAE,cAAc,CAAC,aAAa,CAAC,MAAM;kBAC7C,MAAM,EAAE,cAAc,CAAC,aAAa,CAAC,MAAM;eAC5C,CAAC;cACF,IAAI,kBAAkB,IAAI,cAAc,CAAC,aAAa,CAAC,oBAAoB,EAAE;kBAC3E,cAAc,CAAC,aAAa;uBACzB,oBAAoB,CAAC,CAAC,UAAU,EAAE,iBAAiB,EAAE,cAAc,EAAE,OAAO,EAAE,eAAe,CAAC,CAAC;uBAC/F,IAAI,CAAC,UAAC,GAAG;sBACR,aAAa,CAAC,YAAY,GAAG,GAAG,CAAC,YAAY,CAAC;sBAC9C,aAAa,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;sBAChC,aAAa,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;sBACtC,aAAa,CAAC,aAAa,GAAG,GAAG,CAAC,aAAa,CAAC;sBAChD,aAAa,CAAC,eAAe,GAAG,GAAG,CAAC,eAAe,CAAC;mBACrD,CAAC,CAAC;eACN;WACF;OACF,CAAC;MAEF,OAAO;UACL,qBAAqB,EAAE;cACrB,IAAI,CAAC,aAAa,EAAE;kBAClB,mBAAmB,EAAE,CAAC;eACvB;WACF;UACD,QAAQ,EAAE;cACR,IAAI,aAAa,EAAE;kBACjB,OAAO;sBACL;0BACE,MAAM,EAAE,kDAAkD;0BAC1D,IAAI,EAAE,aAAa;uBACpB;mBACF,CAAC;eACH;cACD,OAAO,EAAE,CAAC;WACX;OACF,CAAC;EACJ;;;;;;"}